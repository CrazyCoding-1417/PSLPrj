{"ast":null,"code":"var convertedVapidKey = urlBase64ToUint8Array(process.env.REACT_APP_PUBLIC_VAPID_KEY);\n\nfunction urlBase64ToUint8Array(base64String) {\n  var padding = \"=\".repeat((4 - base64String.length % 4) % 4); // eslint-disable-next-line\n\n  var base64 = (base64String + padding).replace(/\\-/g, \"+\").replace(/_/g, \"/\");\n  var rawData = window.atob(base64);\n  var outputArray = new Uint8Array(rawData.length);\n\n  for (var i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}\n\nfunction sendDiscount(discount) {\n  return fetch(\"\".concat(process.env.REACT_APP_API_URL, \"/notifications/discount\"), {\n    method: 'POST',\n    body: JSON.stringify(discount),\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n}\n\nexport function discount() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(function (advertisment) {\n      if (!advertisment.pushManager) {\n        console.log('Push manager unavailable.');\n        return;\n      }\n\n      advertisment.pushManager.getSubscription().then(function (existDiscount) {\n        if (existDiscount === null) {\n          console.log('No discount detected, make a request.');\n          advertisment.pushManager.subscribe({\n            applicationServerKey: convertedVapidKey,\n            userVisibleOnly: true\n          }).then(function (newDiscount) {\n            console.log('New discount added.');\n            sendDiscount(newDiscount);\n          }).catch(function (e) {\n            if (Notification.permission !== 'granted') {\n              console.log('Permission was not granted.');\n            } else {\n              console.error('An error ocurred during the discount process.', e);\n            }\n          });\n        } else {\n          console.log('Existed discount detected.');\n          sendDiscount(existDiscount);\n        }\n      });\n    }).catch(function (e) {\n      console.error('An error ocurred during Service Worker registration.', e);\n    });\n  }\n}","map":{"version":3,"sources":["/Users/hsichen1/projects/Lowes-Team-Github/PSLPrj/online-shop-master/client/src/discount.js"],"names":["convertedVapidKey","urlBase64ToUint8Array","process","env","REACT_APP_PUBLIC_VAPID_KEY","base64String","padding","repeat","length","base64","replace","rawData","window","atob","outputArray","Uint8Array","i","charCodeAt","sendDiscount","discount","fetch","REACT_APP_API_URL","method","body","JSON","stringify","headers","navigator","serviceWorker","ready","then","advertisment","pushManager","console","log","getSubscription","existDiscount","subscribe","applicationServerKey","userVisibleOnly","newDiscount","catch","e","Notification","permission","error"],"mappings":"AAAA,IAAMA,iBAAiB,GAAGC,qBAAqB,CAACC,OAAO,CAACC,GAAR,CAAYC,0BAAb,CAA/C;;AAEA,SAASH,qBAAT,CAA+BI,YAA/B,EAA6C;AAC3C,MAAMC,OAAO,GAAG,IAAIC,MAAJ,CAAW,CAAC,IAAIF,YAAY,CAACG,MAAb,GAAsB,CAA3B,IAAgC,CAA3C,CAAhB,CAD2C,CAE3C;;AACA,MAAMC,MAAM,GAAG,CAACJ,YAAY,GAAGC,OAAhB,EAAyBI,OAAzB,CAAiC,KAAjC,EAAwC,GAAxC,EAA6CA,OAA7C,CAAqD,IAArD,EAA2D,GAA3D,CAAf;AAEA,MAAMC,OAAO,GAAGC,MAAM,CAACC,IAAP,CAAYJ,MAAZ,CAAhB;AACA,MAAMK,WAAW,GAAG,IAAIC,UAAJ,CAAeJ,OAAO,CAACH,MAAvB,CAApB;;AAEA,OAAK,IAAIQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,OAAO,CAACH,MAA5B,EAAoC,EAAEQ,CAAtC,EAAyC;AACvCF,IAAAA,WAAW,CAACE,CAAD,CAAX,GAAiBL,OAAO,CAACM,UAAR,CAAmBD,CAAnB,CAAjB;AACD;;AACD,SAAOF,WAAP;AACD;;AAED,SAASI,YAAT,CAAsBC,QAAtB,EAAgC;AAC9B,SAAOC,KAAK,WAAIlB,OAAO,CAACC,GAAR,CAAYkB,iBAAhB,8BAA4D;AACtEC,IAAAA,MAAM,EAAE,MAD8D;AAEtEC,IAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeN,QAAf,CAFgE;AAGtEO,IAAAA,OAAO,EAAE;AACP,sBAAgB;AADT;AAH6D,GAA5D,CAAZ;AAOD;;AAED,OAAO,SAASP,QAAT,GAAoB;AACzB,MAAI,mBAAmBQ,SAAvB,EAAkC;AAChCA,IAAAA,SAAS,CAACC,aAAV,CAAwBC,KAAxB,CACGC,IADH,CACQ,UAASC,YAAT,EAAuB;AAC3B,UAAI,CAACA,YAAY,CAACC,WAAlB,EAA+B;AAC7BC,QAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ;AACA;AACD;;AAEDH,MAAAA,YAAY,CAACC,WAAb,CAAyBG,eAAzB,GACGL,IADH,CACQ,UAASM,aAAT,EAAwB;AAC5B,YAAIA,aAAa,KAAK,IAAtB,EAA4B;AAC1BH,UAAAA,OAAO,CAACC,GAAR,CAAY,uCAAZ;AACAH,UAAAA,YAAY,CAACC,WAAb,CAAyBK,SAAzB,CAAmC;AACjCC,YAAAA,oBAAoB,EAAEtC,iBADW;AAEjCuC,YAAAA,eAAe,EAAE;AAFgB,WAAnC,EAGGT,IAHH,CAGQ,UAASU,WAAT,EAAsB;AAC5BP,YAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACAhB,YAAAA,YAAY,CAACsB,WAAD,CAAZ;AACD,WAND,EAMGC,KANH,CAMS,UAASC,CAAT,EAAY;AACnB,gBAAIC,YAAY,CAACC,UAAb,KAA4B,SAAhC,EAA2C;AACzCX,cAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ;AACD,aAFD,MAEO;AACLD,cAAAA,OAAO,CAACY,KAAR,CAAc,+CAAd,EAA+DH,CAA/D;AACD;AACF,WAZD;AAaD,SAfD,MAeO;AACLT,UAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACAhB,UAAAA,YAAY,CAACkB,aAAD,CAAZ;AACD;AACJ,OArBD;AAsBH,KA7BD,EA8BGK,KA9BH,CA8BS,UAASC,CAAT,EAAY;AACjBT,MAAAA,OAAO,CAACY,KAAR,CAAc,sDAAd,EAAsEH,CAAtE;AACD,KAhCH;AAiCD;AACF","sourcesContent":["const convertedVapidKey = urlBase64ToUint8Array(process.env.REACT_APP_PUBLIC_VAPID_KEY)\n\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = \"=\".repeat((4 - base64String.length % 4) % 4)\n  // eslint-disable-next-line\n  const base64 = (base64String + padding).replace(/\\-/g, \"+\").replace(/_/g, \"/\")\n\n  const rawData = window.atob(base64)\n  const outputArray = new Uint8Array(rawData.length)\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i)\n  }\n  return outputArray\n}\n\nfunction sendDiscount(discount) {\n  return fetch(`${process.env.REACT_APP_API_URL}/notifications/discount`, {\n    method: 'POST',\n    body: JSON.stringify(discount),\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  })\n}\n\nexport function discount() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(function(advertisment) {\n        if (!advertisment.pushManager) {\n          console.log('Push manager unavailable.')\n          return\n        }\n\n        advertisment.pushManager.getSubscription()\n          .then(function(existDiscount) {\n            if (existDiscount === null) {\n              console.log('No discount detected, make a request.')\n              advertisment.pushManager.subscribe({\n                applicationServerKey: convertedVapidKey,\n                userVisibleOnly: true,\n              }).then(function(newDiscount) {\n                console.log('New discount added.')\n                sendDiscount(newDiscount)\n              }).catch(function(e) {\n                if (Notification.permission !== 'granted') {\n                  console.log('Permission was not granted.')\n                } else {\n                  console.error('An error ocurred during the discount process.', e)\n                }\n              })\n            } else {\n              console.log('Existed discount detected.')\n              sendDiscount(existDiscount)\n            }\n        })\n    })\n      .catch(function(e) {\n        console.error('An error ocurred during Service Worker registration.', e)\n      })\n  }\n}\n"]},"metadata":{},"sourceType":"module"}